<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<title>Mental States & Decision-Making ‚Äî Full jsPsych Study (RU/EN)</title>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<link href="https://cdn.jsdelivr.net/npm/jspsych@7.2.0/dist/css/jspsych.css" rel="stylesheet">
<style>
  body{font-family:Arial,Helvetica,sans-serif;background:#fff;margin:0;padding:12px;color:#111}
  .container{max-width:980px;margin:12px auto;padding:18px}
  h1,h2{margin:6px 0}
  .preamble{font-size:14px;color:#333}
  .center{text-align:center}
  .small{font-size:12px;color:#444}
  .btn{font-size:15px;padding:8px 14px}
  .balloon{font-size:56px}
</style>
</head>
<body>
<div class="container">
  <h1 class="center">–í–ª–∏—è–Ω–∏–µ –ø—Å–∏—Ö–∏—á–µ—Å–∫–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –Ω–∞ –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏–π / The Influence of Mental States on Decision-Making</h1>
  <p class="preamble">–†—É—Å—Å–∫–∏–π: –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–≤–µ—á–∞–π—Ç–µ —á–µ—Å—Ç–Ω–æ. English: Please answer honestly. Duration ‚âà 25‚Äì35 minutes.</p>
</div>

<!-- jsPsych and plugins -->
<script src="https://cdn.jsdelivr.net/npm/jspsych@7.2.0/dist/jspsych.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@jspsych/plugin-html-button-response@1.1.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@jspsych/plugin-survey-likert@1.1.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@jspsych/plugin-survey-multi-choice@1.1.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@jspsych/plugin-survey-text@1.1.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@jspsych/plugin-call-function@1.0.0"></script>

<script>
/* ==========================
   Full jsPsych experiment
   - Embedded Google Sheets POST URL
   - Strict 10s timer for time-pressure items (auto-advance)
   - Bilingual RU / EN
   ========================== */

const GOOGLE_SHEETS_URL = "https://script.google.com/macros/s/AKfycbwBrzpxB2nd4KuexMohLrlUczm_tnTbn8J7mu86ET7Sh0YItB7HG307LemjCCmPg092/exec";

const jsPsych = initJsPsych({
  on_finish: function() {
    // Final save handled in end block; keep default
  }
});

const timeline = [];

/* -----------------------
   LANGUAGE CHOICE
   ----------------------- */
const lang_choice = {
  type: jsPsychHtmlButtonResponse,
  stimulus: `<div class="center"><h2>–í—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ / Choose language</h2>
             <p>–†—É—Å—Å–∫–∏–π / English</p></div>`,
  choices: ['–†—É—Å—Å–∫–∏–π','English'],
  on_finish: function(data){
    data.language = data.response === 0 ? 'ru' : 'en';
    // store chosen language in global
    window._study_language = data.response === 0 ? 'ru' : 'en';
  }
};
timeline.push(lang_choice);

/* Helper: bilingual text printer */
function txt(ru, en){
  if(window._study_language === 'ru') return ru + '<br><em style="font-size:12px;color:#333">' + en + '</em>';
  else return en + '<br><em style="font-size:12px;color:#333">' + ru + '</em>';
}

/* -----------------------
   Welcome / Consent
   ----------------------- */
timeline.push({
  type: jsPsychHtmlButtonResponse,
  stimulus: function(){
    return `<h3>${txt("–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ —Å–æ–≥–ª–∞—Å–∏–µ","Information & consent")}</h3>
            <p>${txt("–≠—Ç–æ—Ç –æ–ø—Ä–æ—Å –∞–Ω–æ–Ω–∏–º–Ω—ã–π –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –¥–æ–∫—Ç–æ—Ä—Å–∫–æ–π –¥–∏—Å—Å–µ—Ä—Ç–∞—Ü–∏–∏. –ù–∞–∂–º–∏—Ç–µ —Å–æ–≥–ª–∞—Å–∏–µ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.","This study is anonymous and for a PhD dissertation. Click consent to continue.")}</p>`;
  },
  choices: [txt("–Ø —Å–æ–≥–ª–∞—Å–µ–Ω / –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å","I consent / Continue")],
  on_finish: function(data){
    data.consent = true;
  }
});

/* -----------------------
   DEMOGRAPHICS: age group
   ----------------------- */
timeline.push({
  type: jsPsychSurveyMultiChoice,
  questions: [
    {prompt: function(){ return txt("–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ—é –≤–æ–∑—Ä–∞—Å—Ç–Ω—É—é –≥—Ä—É–ø–ø—É:","Please select your age group:"); },
     options:["18‚Äì24","25‚Äì34","35‚Äì44","45‚Äì54","55+"],
     required:true, name:"age_group"}
  ]
});

/* -----------------------
   RANDOM ASSIGNMENTS
   - framing: 'gain' or 'loss'
   - cognitive_load: 'low' or 'high'
   - we'll store these as variables and display appropriate vignettes
   ----------------------- */
timeline.push({
  type: jsPsychCallFunction,
  func: function(){
    const framing = Math.random() < 0.5 ? 'gain' : 'loss';
    const cogload = Math.random() < 0.5 ? 'low' : 'high';
    const timepressure = Math.random() < 0.5 ? 'no' : '10s'; // separate randomization optional; we will use time pressure block where needed
    window._assignments = {framing: framing, cognitive_load: cogload, timepressure: timepressure};
    jsPsych.data.addProperties({assignment_framing: framing, assignment_cognitive_load: cogload, assignment_timepressure: timepressure});
  }
});

/* -----------------------
   FRAMING VIGNETTE (shows gain or loss based on assignment)
   ----------------------- */
const gain_vignette = {
  type: jsPsychHtmlButtonResponse,
  stimulus: function(){
    return `<div>${txt("–°—Ü–µ–Ω–∞—Ä–∏–π ‚Äî –ö–∞–¥—Ä –≤—ã–∏–≥—Ä—ã—à–∞","Scenario ‚Äî Gain frame")}<p>${txt(
      "–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –æ–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ –±–æ–ª–µ–∑–Ω—å —É–±—å–µ—Ç 600 —á–µ–ª–æ–≤–µ–∫. –ü—Ä–æ–≥—Ä–∞–º–º–∞ A —Å–ø–∞—Å–µ—Ç 200 —á–µ–ª–æ–≤–µ–∫. –ü—Ä–æ–≥—Ä–∞–º–º–∞ B: 1/3 —à–∞–Ω—Å, —á—Ç–æ 600 —á–µ–ª–æ–≤–µ–∫ –±—É–¥—É—Ç —Å–ø–∞—Å–µ–Ω—ã, –∏ 2/3 —à–∞–Ω—Å, —á—Ç–æ –Ω–∏–∫—Ç–æ –Ω–µ –±—É–¥–µ—Ç —Å–ø–∞—Å–µ–Ω.",
      "Imagine a disease is expected to kill 600 people. Program A will save 200 people. Program B has a 1/3 chance that 600 people will be saved and a 2/3 chance that no one will be saved."
    )}</p></div>`;
  },
  choices: [txt("–î–∞–ª–µ–µ / Next","Next")]
};
const gain_choice = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {prompt: function(){ return txt("–ö–∞–∫—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ?","Which program do you choose?"); },
     options:[txt("–ü—Ä–æ–≥—Ä–∞–º–º–∞ A ‚Äî –°–ø–∞—Å–µ—Ç 200","Program A ‚Äî saves 200"), txt("–ü—Ä–æ–≥—Ä–∞–º–º–∞ B ‚Äî 1/3 —à–∞–Ω—Å —Å–ø–∞—Å—Ç–∏ 600","Program B ‚Äî probabilistic option")],
     required:true, name:"framing_choice"}
  ]
};

const loss_vignette = {
  type: jsPsychHtmlButtonResponse,
  stimulus: function(){
    return `<div>${txt("–°—Ü–µ–Ω–∞—Ä–∏–π ‚Äî –ö–∞–¥—Ä –ø–æ—Ç–µ—Ä—å","Scenario ‚Äî Loss frame")}<p>${txt(
      "–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –æ–∂–∏–¥–∞–µ—Ç—Å—è, —á—Ç–æ –±–æ–ª–µ–∑–Ω—å —É–±—å–µ—Ç 600 —á–µ–ª–æ–≤–µ–∫. –ü—Ä–æ–≥—Ä–∞–º–º–∞ A –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Ç–æ–º—É, —á—Ç–æ 400 —á–µ–ª–æ–≤–µ–∫ —É–º—Ä—É—Ç. –ü—Ä–æ–≥—Ä–∞–º–º–∞ B: 1/3 —à–∞–Ω—Å, —á—Ç–æ –Ω–∏–∫—Ç–æ –Ω–µ —É–º—Ä–µ—Ç, –∏ 2/3 —à–∞–Ω—Å, —á—Ç–æ 600 —á–µ–ª–æ–≤–µ–∫ —É–º—Ä—É—Ç.",
      "Imagine a disease is expected to kill 600 people. Program A will result in 400 people dying. Program B has a 1/3 chance that nobody will die and a 2/3 chance that 600 people will die."
    )}</p></div>`;
  },
  choices: [txt("–î–∞–ª–µ–µ / Next","Next")]
};
const loss_choice = {
  type: jsPsychSurveyMultiChoice,
  questions: [
    {prompt: function(){ return txt("–ö–∞–∫—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ?","Which program do you choose?"); },
     options:[txt("–ü—Ä–æ–≥—Ä–∞–º–º–∞ A ‚Äî 400 —É–º—Ä—É—Ç","Program A ‚Äî 400 will die"), txt("–ü—Ä–æ–≥—Ä–∞–º–º–∞ B ‚Äî —Ä–∏—Å–∫ 1/3 —Å–ø–∞—Å–µ–Ω–∏—è","Program B ‚Äî probabilistic option")],
     required:true, name:"framing_choice"}
  ]
};

// conditional display based on random assignment
timeline.push({
  conditional_function: function(){ return window._assignments && window._assignments.framing === 'gain'; },
  timeline: [gain_vignette, gain_choice]
});
timeline.push({
  conditional_function: function(){ return window._assignments && window._assignments.framing === 'loss'; },
  timeline: [loss_vignette, loss_choice]
});

/* -----------------------
   COGNITIVE LOAD SCENARIO (simple vs complex)
   We'll show either a short simple text or a complex longer paragraph
   ----------------------- */
const simple_load = {
  type: jsPsychHtmlButtonResponse,
  stimulus: function(){ return `<div>${txt("–ù–∏–∑–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: –∫–æ—Ä–æ—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è","Low load: short information")}</div>`; },
  choices: [txt("–î–∞–ª–µ–µ / Next","Next")]
};
const complex_load = {
  type: jsPsychHtmlButtonResponse,
  stimulus: function(){ return `<div>${txt("–í—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞: –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –¥–µ—Ç–∞–ª—è–º–∏ (—Å–∏–º—É–ª–∏—Ä—É–µ—Ç —Å–ª–æ–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é)","High load: longer text with multiple details (simulating complex info)")}</div>`; },
  choices: [txt("–î–∞–ª–µ–µ / Next","Next")]
};
timeline.push({
  conditional_function: function(){ return window._assignments && window._assignments.cognitive_load === 'low'; },
  timeline: [simple_load]
});
timeline.push({
  conditional_function: function(){ return window._assignments && window._assignments.cognitive_load === 'high'; },
  timeline: [complex_load]
});

/* -----------------------
   TIME-PRESSURE TASK (strict 10-second enforced)
   Uses trial_duration to auto-advance if time runs out; marks timeout
   ----------------------- */
const tp_intro = {
  type: jsPsychHtmlButtonResponse,
  stimulus: function(){ return `<div>${txt("–°—Ü–µ–Ω–∞—Ä–∏–π: –í—ã–±–µ—Ä–∏—Ç–µ –∫–∞–∫ –º–æ–∂–Ω–æ –±—ã—Å—Ç—Ä–µ–µ (10 —Å–µ–∫)","Time-pressure scenario: Choose as quickly as possible (10 s)")}</div>`; },
  choices: [txt("–ù–∞—á–∞—Ç—å / Begin","Begin")]
};
const tp_choice = {
  type: jsPsychSurveyMultiChoice,
  trial_duration: 10000, // strict 10s
  questions: [
    {prompt: function(){ return txt("–ö–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –∏–Ω–≤–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤—ã –≤—ã–±–∏—Ä–∞–µ—Ç–µ?","Which investment option do you choose?"); },
     options:[txt("A ‚Äî –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–∏–±—ã–ª—å $30","A ‚Äî Safe: guaranteed $30"),
              txt("B ‚Äî –†–∏—Å–∫–æ–≤–∞–Ω–Ω–∞—è –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏—è, 50% —à–∞–Ω—Å $60","B ‚Äî Risky: 50% chance $60")],
     required:true, name:"timepressure_choice"}
  ],
  on_finish: function(data){
    // if participant didn't answer before timer, response is null; we mark timed_out
    const last = jsPsych.data.get().last(1).values()[0];
    if(last && last.response === null){
      jsPsych.data.addProperties({timepressure_timed_out:true});
    } else {
      jsPsych.data.addProperties({timepressure_timed_out:false});
    }
  }
};
timeline.push(tp_intro, tp_choice);

/* -----------------------
   MDMQ (Melbourne Decision-Making Questionnaire) adaptation
   22 items, 5-point scale
   ----------------------- */
const mdmq_labels = ["1 ‚Äî –ù–∏–∫–æ–≥–¥–∞ / 1 Never","2 ‚Äî –†–µ–¥–∫–æ / 2 Rarely","3 ‚Äî –ò–Ω–æ–≥–¥–∞ / 3 Sometimes","4 ‚Äî –ß–∞—Å—Ç–æ / 4 Often","5 ‚Äî –í—Å–µ–≥–¥–∞ / 5 Always"];
const mdmq_questions = [
  "–Ø —Ç—â–∞—Ç–µ–ª—å–Ω–æ –æ–±–¥—É–º—ã–≤–∞—é –≤—Å–µ –≤–æ–∑–º–æ–∂–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ. / I carefully consider alternatives before making decisions.",
  "–Ø —Å—Ç–∞—Ä–∞—é—Å—å –∏–∑–±–µ–≥–∞—Ç—å —Ç—Ä—É–¥–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π. / I try to avoid difficult decisions.",
  "–Ø —á–∞—Å—Ç–æ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—é –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –º–æ–º–µ–Ω—Ç–∞. / I often delay decisions until the last moment.",
  "–Ø –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é, —á—Ç–æ–±—ã —Ä–µ—à–µ–Ω–∏—è –ø—Ä–∏–Ω–∏–º–∞–ª–∏ –¥—Ä—É–≥–∏–µ. / I prefer others to make decisions for me.",
  "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–µ–±—è —Å–ø–æ–∫–æ–π–Ω–æ –∏ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–Ω–æ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å –≤–∞–∂–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ. / I feel calm and focused when I must decide.",
  "–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–æ, —è —á—É–≤—Å—Ç–≤—É—é –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ –∏ –Ω–µ—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å. / When decisions must be fast, I feel tension and uncertainty.",
  "–ú–Ω–µ —Ç—Ä—É–¥–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å—Å—è, –µ—Å–ª–∏ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–∞–∂—É—Ç—Å—è –ø–æ—Ö–æ–∂–∏–º–∏. / I find it hard to decide when options seem similar.",
  "–Ø —á–∞—Å—Ç–æ –æ—Å—Ç–∞–≤–ª—è—é —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≤–æ–ª—é —Å–ª—É—á–∞—è. / I often leave decisions to chance.",
  "–Ø —Å—Ç–∞—Ä–∞—é—Å—å —Å–æ–±—Ä–∞—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –ø–µ—Ä–µ–¥ –ø—Ä–∏–Ω—è—Ç–∏–µ–º —Ä–µ—à–µ–Ω–∏—è. / I try to gather as much information as possible before deciding.",
  "–Ø —Å–∫–ª–æ–Ω–µ–Ω –ø–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏—è. / I tend to rely on first impressions when deciding.",
  "–ú–µ–Ω—è —Ä–∞–∑–¥—Ä–∞–∂–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏–µ –ø–æ–¥ –¥–∞–≤–ª–µ–Ω–∏–µ–º. / I resent having to decide under pressure.",
  "–Ø —Å—Ç–∞—Ä–∞—é—Å—å –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ —Å—á–∏—Ç–∞—é –º–æ—Ä–∞–ª—å–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏. / I try to make decisions that I consider morally right.",
  "–ò–Ω–æ–≥–¥–∞ —è –∏–∑–±–µ–≥–∞—é –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π, —á—Ç–æ–±—ã –Ω–µ –Ω–µ—Å—Ç–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. / Sometimes I avoid decisions to avoid responsibility.",
  "–û–±—ã—á–Ω–æ —è –ø—Ä–∏–Ω–∏–º–∞—é —Ä–µ—à–µ–Ω–∏—è –±—ã—Å—Ç—Ä–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ. / I usually decide quickly and confidently.",
  "–ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –¥–ª—è –º–µ–Ω—è —É—Ç–æ–º–∏—Ç–µ–ª–µ–Ω –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å—Ç—Ä–µ—Å—Å. / Decision-making is tiring and stressful for me.",
  "–Ø —á–∞—Å—Ç–æ –º–µ–Ω—è—é —Å–≤–æ–µ –º–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —É–∂–µ –ø—Ä–∏–Ω—è–ª —Ä–µ—à–µ–Ω–∏–µ. / I often change my mind after making a decision.",
  "–Ø –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é —Ç—â–∞—Ç–µ–ª—å–Ω–æ –≤—Å–µ –æ–±–¥—É–º–∞—Ç—å –ø–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ. / I prefer to think things through carefully before deciding.",
  "–Ø —Å—Ç–∞—Ä–∞—é—Å—å –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –ø—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ—à–µ–Ω–∏—è –∫–∞–∫ –º–æ–∂–Ω–æ –¥–æ–ª—å—à–µ. / I try to postpone decisions as long as possible.",
  "–Ø —á—É–≤—Å—Ç–≤—É—é —Ç—Ä–µ–≤–æ–≥—É, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏. / I feel anxious when choosing between several options.",
  "–Ø —Å–∫–ª–æ–Ω–µ–Ω —Å–ª–µ–¥–æ–≤–∞—Ç—å —Å–æ–≤–µ—Ç–∞–º –¥—Ä—É–≥–∏—Ö –ø—Ä–∏ –ø—Ä–∏–Ω—è—Ç–∏–∏ —Ä–µ—à–µ–Ω–∏–π. / I tend to follow others' advice when deciding.",
  "–Ø —É–≤–µ—Ä–µ–Ω, —á—Ç–æ –º–æ–≥—É –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–∏—Ç—É–∞—Ü–∏–π. / I am confident I can make correct decisions in most situations.",
  "–Ø —á—É–≤—Å—Ç–≤—É—é —Å–ø–µ—à–∫—É –∏ –¥–∞–≤–ª–µ–Ω–∏–µ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏–µ. / I feel rushed and pressured when a quick decision is required."
];
const mdmq_qs = mdmq_questions.map((q,i) => ({prompt: q, labels: mdmq_labels, required:true, name:`mdmq_${i+1}`}));
timeline.push({type: jsPsychSurveyLikert, preamble: "<h3>MDMQ ‚Äî Melbourne Decision-Making Questionnaire</h3>", questions: mdmq_qs});

/* -----------------------
   PANAS ‚Äî 20 items, 5-point scale
   ----------------------- */
const panas_labels = ["1 = –û—á–µ–Ω—å —Å–ª–∞–±–æ / 1 Very slightly or not at all","2 = –ù–µ–º–Ω–æ–≥–æ / 2 A little","3 = –£–º–µ—Ä–µ–Ω–Ω–æ / 3 Moderately","4 = –î–æ–≤–æ–ª—å–Ω–æ —Å–∏–ª—å–Ω–æ / 4 Quite a bit","5 = –û—á–µ–Ω—å —Å–∏–ª—å–Ω–æ / 5 Extremely"];
const panas_items = [
  "–ó–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω / Interested","–í –±–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏ / Distressed","–í–æ–∑–±—É–∂–¥–µ–Ω–Ω—ã–π / Excited","–†–∞—Å—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π / Upset","–°–∏–ª—å–Ω—ã–π / Strong",
  "–í–∏–Ω–æ–≤–Ω—ã–π / Guilty","–ù–∞–ø—É–≥–∞–Ω–Ω—ã–π / Scared","–í—Ä–∞–∂–¥–µ–±–Ω—ã–π / Hostile","–≠–Ω—Ç—É–∑–∏–∞—Å—Ç / Enthusiastic","–ì–æ—Ä–¥—ã–π / Proud",
  "–†–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω—ã–π / Irritable","–ë–¥–∏—Ç–µ–ª—å–Ω—ã–π / Alert","–°—Ç—ã–¥–Ω–æ / Ashamed","–í–¥–æ—Ö–Ω–æ–≤–ª–µ–Ω–Ω—ã–π / Inspired","–ù–µ—Ä–≤–Ω—ã–π / Nervous",
  "–†–µ—à–∏—Ç–µ–ª—å–Ω—ã–π / Determined","–í–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã–π / Attentive","–í—Å—Ç—Ä–µ–≤–æ–∂–µ–Ω–Ω—ã–π / Jittery","–ê–∫—Ç–∏–≤–Ω—ã–π / Active","–ë–æ—è—Ç—å—Å—è / Afraid"
];
const panas_qs = panas_items.map((it,i)=>({prompt: it, labels: panas_labels, required:true, name:`panas_${i+1}`}));
timeline.push({type: jsPsychSurveyLikert, preamble:"<h3>PANAS ‚Äî Positive and Negative Affect Schedule</h3>", questions: panas_qs});

/* -----------------------
   WLEIS ‚Äî 16 items, 7-point scale
   ----------------------- */
const wleis_labels = ["1 ‚Äî –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω","2 ‚Äî –ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω","3 ‚Äî –°–ª–µ–≥–∫–∞ –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω","4 ‚Äî –ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π","5 ‚Äî –°–ª–µ–≥–∫–∞ —Å–æ–≥–ª–∞—Å–µ–Ω","6 ‚Äî –°–æ–≥–ª–∞—Å–µ–Ω","7 ‚Äî –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≥–ª–∞—Å–µ–Ω"];
const wleis_items = [
  "–Ø —Ö–æ—Ä–æ—à–æ –ø–æ–Ω–∏–º–∞—é, –ø–æ—á–µ–º—É —É –º–µ–Ω—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ –≤–æ–∑–Ω–∏–∫–∞—é—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —á—É–≤—Å—Ç–≤–∞. / I usually know why I have certain feelings.",
  "–Ø —Ö–æ—Ä–æ—à–æ –ø–æ–Ω–∏–º–∞—é —Å–≤–æ–∏ —ç–º–æ—Ü–∏–∏. / I understand my emotions.",
  "–Ø –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ —è —á—É–≤—Å—Ç–≤—É—é. / I truly understand what I feel.",
  "–Ø –≤—Å–µ–≥–¥–∞ –∑–Ω–∞—é, —Å—á–∞—Å—Ç–ª–∏–≤ —è –∏–ª–∏ –Ω–µ—Ç. / I always know whether I am happy or not.",
  "–Ø –≤—Å–µ–≥–¥–∞ –ø–æ–Ω–∏–º–∞—é —ç–º–æ—Ü–∏–∏ —Å–≤–æ–∏—Ö –¥—Ä—É–∑–µ–π –ø–æ –∏—Ö –ø–æ–≤–µ–¥–µ–Ω–∏—é. / I understand friends' emotions from behavior.",
  "–Ø —Ö–æ—Ä–æ—à–æ –Ω–∞–±–ª—é–¥–∞—é –∑–∞ —ç–º–æ—Ü–∏—è–º–∏ –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π. / I can observe others' emotions well.",
  "–Ø —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ —á—É–≤—Å—Ç–≤–∞–º –∏ —ç–º–æ—Ü–∏—è–º –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π. / I am sensitive to others' feelings.",
  "–Ø —Ö–æ—Ä–æ—à–æ –ø–æ–Ω–∏–º–∞—é —ç–º–æ—Ü–∏–∏ –æ–∫—Ä—É–∂–∞—é—â–∏—Ö –º–µ–Ω—è –ª—é–¥–µ–π. / I understand emotions of people around me.",
  "–Ø –≤—Å–µ–≥–¥–∞ —Å—Ç–∞–≤–ª—é –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π —Ü–µ–ª–∏, –∞ –∑–∞—Ç–µ–º —Å—Ç–∞—Ä–∞—é—Å—å –∏–∑–æ –≤—Å–µ—Ö —Å–∏–ª –∏—Ö –¥–æ—Å—Ç–∏—á—å. / I set goals and strive to achieve them.",
  "–Ø –≤—Å–µ–≥–¥–∞ –≥–æ–≤–æ—Ä—é —Å–µ–±–µ, —á—Ç–æ —è –∫–æ–º–ø–µ—Ç–µ–Ω—Ç–Ω—ã–π —á–µ–ª–æ–≤–µ–∫. / I tell myself I am competent.",
  "–Ø —á–µ–ª–æ–≤–µ–∫ —Å –≤—ã—Å–æ–∫–æ–π —Å–∞–º–æ–º–æ—Ç–∏–≤–∞—Ü–∏–µ–π. / I am highly self-motivated.",
  "–Ø –≤—Å–µ–≥–¥–∞ –±—É–¥—É –ø–æ–¥–±–∞–¥—Ä–∏–≤–∞—Ç—å —Å–µ–±—è, —á—Ç–æ–±—ã —Å—Ç–∞—Ä–∞—Ç—å—Å—è –∏–∑–æ –≤—Å–µ—Ö —Å–∏–ª. / I encourage myself to try hard.",
  "–Ø —É–º–µ—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ —Ä–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏. / I control my temper and handle difficulties rationally.",
  "–Ø –≤–ø–æ–ª–Ω–µ —Å–ø–æ—Å–æ–±–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ —ç–º–æ—Ü–∏–∏. / I am able to control my emotions.",
  "–Ø –≤—Å–µ–≥–¥–∞ –º–æ–≥—É –±—ã—Å—Ç—Ä–æ —É—Å–ø–æ–∫–æ–∏—Ç—å—Å—è, –∫–æ–≥–¥–∞ –æ—á–µ–Ω—å –∑–ª—é—Å—å. / I can calm down quickly when angered.",
  "–Ø —Ö–æ—Ä–æ—à–æ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é —Å–≤–æ–∏ —ç–º–æ—Ü–∏–∏. / I manage my emotions well."
];
const wleis_qs = wleis_items.map((it,i)=>({prompt: it, labels: wleis_labels, required:true, name:`wleis_${i+1}`}));
timeline.push({type: jsPsychSurveyLikert, preamble:"<h3>WLEIS ‚Äî Wong-Law Emotional Intelligence Scale</h3>", questions: wleis_qs});

/* -----------------------
   CRT ‚Äî 7 short answer items
   ----------------------- */
const crt_questions = [
  {prompt: "–ë–∏—Ç–∞ –∏ –º—è—á —Å—Ç–æ—è—Ç –≤ –æ–±—â–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ $1.10. –ë–∏—Ç–∞ —Å—Ç–æ–∏—Ç –Ω–∞ $1 –±–æ–ª—å—à–µ, —á–µ–º –º—è—á. –°–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç –º—è—á? / A bat and ball cost $1.10. The bat costs $1 more than the ball. How much is the ball?", name:"crt_ball"},
  {prompt: "–ï—Å–ª–∏ 5 –º–∞—à–∏–Ω –∑–∞ 5 –º–∏–Ω—É—Ç –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç 5 –≤–∏–¥–∂–µ—Ç–æ–≤, —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è 100 –º–∞—à–∏–Ω–∞–º, —á—Ç–æ–±—ã –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ 100 –≤–∏–¥–∂–µ—Ç–æ–≤? / If 5 machines take 5 minutes for 5 widgets, how long for 100 machines to make 100 widgets?", name:"crt_widgets"},
  {prompt: "–õ–∏—Å—Ç—å—è –∫—É–≤—à–∏–Ω–æ–∫ —É–¥–≤–∞–∏–≤–∞—é—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ; –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è 48 –¥–Ω–µ–π, —á—Ç–æ–±—ã –ø–æ–∫—Ä—ã—Ç—å –≤–µ—Å—å –ø—Ä—É–¥, —Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è, —á—Ç–æ–±—ã –ø–æ–∫—Ä—ã—Ç—å –ø–æ–ª–æ–≤–∏–Ω—É –ø—Ä—É–¥–∞? / Lily pads double daily; if 48 days to fill the pond, how long to half?", name:"crt_lily"},
  {prompt: "–ï—Å–ª–∏ –≤—ã –æ–±–≥–æ–Ω—è–µ—Ç–µ —á–µ–ª–æ–≤–µ–∫–∞, –∑–∞–Ω–∏–º–∞—é—â–µ–≥–æ –≤—Ç–æ—Ä–æ–µ –º–µ—Å—Ç–æ, –∫–∞–∫–æ–µ –º–µ—Å—Ç–æ –≤—ã —Ç–µ–ø–µ—Ä—å –∑–∞–Ω–∏–º–∞–µ—Ç–µ? / If you overtake the person in second place, what place are you now?", name:"crt_race"},
  {prompt: "–£ –æ—Ç—Ü–∞ –≠–º–∏–ª–∏ —Ç—Ä–∏ –¥–æ—á–µ—Ä–∏. –ü–µ—Ä–≤—ã—Ö –¥–≤—É—Ö –∑–æ–≤—É—Ç –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –∏ –í—Ç–æ—Ä–Ω–∏–∫. –ö–∞–∫ –∑–æ–≤—É—Ç —Ç—Ä–µ—Ç—å—é –¥–æ—á—å? / Emily's father has three daughters; two are Monday and Tuesday. What's the third daughter's name?", name:"crt_emily"},
  {prompt: "–°–∫–æ–ª—å–∫–æ –º–µ—Å—è—Ü–µ–≤ –≤ –≥–æ–¥—É –∏–º–µ—é—Ç 28 –¥–Ω–µ–π? / How many months have 28 days?", name:"crt_months"},
  {prompt: "–£ —Ñ–µ—Ä–º–µ—Ä–∞ –±—ã–ª–æ 15 –æ–≤–µ—Ü, –∏ –≤—Å–µ, –∫—Ä–æ–º–µ 8, –ø–æ–≥–∏–±–ª–∏. –°–∫–æ–ª—å–∫–æ –æ—Å—Ç–∞–ª–æ—Å—å? / A farmer had 15 sheep and all but 8 died. How many remain?", name:"crt_sheep"}
];
timeline.push({type: jsPsychSurveyText, preamble:"<h3>CRT ‚Äî Cognitive Reflection Test (short answers)</h3>", questions: crt_questions});

/* -----------------------
   Karpov Reflexivity Questionnaire ‚Äî short form (13 items, 7-point)
   ----------------------- */
const karpov_items = [
  "–Ø —á–∞—Å—Ç–æ –∑–∞–¥—É–º—ã–≤–∞—é—Å—å, –ø–æ—á–µ–º—É —è –ø–æ—Å—Ç—É–ø–∏–ª –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º –æ–±—Ä–∞–∑–æ–º –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏. / I often reflect on why I acted the way I did in a situation.",
  "–Ø –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é —Å–≤–æ–∏ –º—ã—Å–ª–∏ –∏ —á—É–≤—Å—Ç–≤–∞, —á—Ç–æ–±—ã –ª—É—á—à–µ –ø–æ–Ω—è—Ç—å —Å–µ–±—è. / I analyze my thoughts and feelings to understand myself.",
  "–Ø –≤–∏–∂—É, –∫–∞–∫ –º–æ–∏ –Ω—ã–Ω–µ—à–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏—è —Å–≤—è–∑–∞–Ω—ã —Å –º–æ–∏–º –ø—Ä–æ—à–ª—ã–º –æ–ø—ã—Ç–æ–º. / I see how my current actions relate to past experiences.",
  "–Ø —Å–ø–æ—Å–æ–±–µ–Ω –æ—Ü–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Å–≤–æ–∏—Ö —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π. / I can evaluate the correctness of my own decisions.",
  "–Ø –¥—É–º–∞—é –æ —Ç–æ–º, –∫–∞–∫ –¥—Ä—É–≥–∏–µ –ª—é–¥–∏ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞—é—Ç –º–æ—ë –ø–æ–≤–µ–¥–µ–Ω–∏–µ. / I think about how others perceive my behavior.",
  "–Ø –º–æ–≥—É —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å, –∫–æ–≥–¥–∞ –º–æ–∏ —ç–º–æ—Ü–∏–∏ –≤–ª–∏—è—é—Ç –Ω–∞ –º–æ–∏ —Å—É–∂–¥–µ–Ω–∏—è. / I can recognize when emotions influence my judgments.",
  "–Ø —á–∞—Å—Ç–æ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—é —Å–≤–æ–∏ –≤–∑–≥–ª—è–¥—ã –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. / I often revise my views after getting new information.",
  "–Ø –º–æ–≥—É –æ—Ç—Å—Ç—Ä–∞–Ω–∏—Ç—å—Å—è –∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—é —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã. / I can detach and view a situation from the outside.",
  "–Ø –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç –º–æ—ë –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤ —Ä–∞–∑–Ω—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö. / I understand what motivates my behavior.",
  "–Ø –º–æ–≥—É –ø—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –º–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ–≤–ª–∏—è—é—Ç –Ω–∞ –¥—Ä—É–≥–∏—Ö. / I can predict how my actions affect others.",
  "–Ø –æ—Å–æ–∑–Ω–∞—é —Å–≤–æ–∏ —Å–∏–ª—å–Ω—ã–µ –∏ —Å–ª–∞–±—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã. / I am aware of my strengths and weaknesses.",
  "–Ø —É–º–µ—é –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ –º—ã—Å–ª–∏ –≤–æ –≤—Ä–µ–º—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π. / I can analyze my thoughts during difficult tasks.",
  "–Ø —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –ø–ª–∞–Ω–∏—Ä—É—é, –∫–∞–∫ —É–ª—É—á—à–∏—Ç—å —Å–≤–æ–∏ –±—É–¥—É—â–∏–µ –¥–µ–π—Å—Ç–≤–∏—è. / I consciously plan how to improve future actions."
];
const karpov_qs = karpov_items.map((it,i)=>({prompt: it, labels: wleis_labels, required:true, name:`karpov_${i+1}`}));
timeline.push({type: jsPsychSurveyLikert, preamble:"<h3>Karpov Reflexivity ‚Äî short form</h3>", questions: karpov_qs});

/* -----------------------
   Prokhorov Relief Scale (Short) ‚Äî 9 items, 7-point
   ----------------------- */
const relief_items = [
  "–Ø —á—É–≤—Å—Ç–≤—É—é —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Ä–∞–≤–Ω–æ–≤–µ—Å–∏–µ. / I feel emotional balance.",
  "–Ø –æ—â—É—â–∞—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ. / I feel inner calm and relaxation.",
  "–ú–æ–∏ –º—ã—Å–ª–∏ —è—Å–Ω—ã –∏ —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω—ã. / My thoughts are clear and focused.",
  "–Ø —á—É–≤—Å—Ç–≤—É—é –æ–±–ª–µ–≥—á–µ–Ω–∏–µ –æ—Ç –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è. / I feel relief from tension.",
  "–Ø –º–æ–≥—É –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–≤–æ–∏ —ç–º–æ—Ü–∏–∏. / I can control my emotions.",
  "–Ø —Å–≤–æ–±–æ–¥–µ–Ω –æ—Ç —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–≤–æ–≥–∏. / I am free from irritability and anxiety.",
  "–Ø –ª–µ–≥–∫–æ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—Ä—É—é—Å—å –Ω–∞ —Ç–æ–º, —á—Ç–æ –¥–µ–ª–∞—é. / I can concentrate easily.",
  "–Ø —á—É–≤—Å—Ç–≤—É—é —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å. / I feel emotional stability.",
  "–Ø –æ—â—É—â–∞—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –≥–∞—Ä–º–æ–Ω–∏—é. / I feel inner harmony."
];
const relief_qs = relief_items.map((it,i)=>({prompt: it, labels: wleis_labels, required:true, name:`relief_${i+1}`}));
timeline.push({type: jsPsychSurveyLikert, preamble:"<h3>Prokhorov Relief Scale ‚Äî short form</h3>", questions: relief_qs});

/* -----------------------
   Peisakhov Self-Management ‚Äî 15 items, 5-point
   ----------------------- */
const selfmg_items = [
  "–Ø —á—ë—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—è—é, —á–µ–≥–æ —Ö–æ—á—É –¥–æ—Å—Ç–∏—á—å, –ø—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É. / I clearly define goals before starting work.",
  "–Ø —Å—Ç–∞–≤–ª—é —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–µ —Ü–µ–ª–∏. / I set realistic goals.",
  "–ü–æ—Å—Ç–∞–≤–∏–≤ —Ü–µ–ª—å, —è –∑–∞–¥—É–º—ã–≤–∞—é—Å—å, –ø–æ—á–µ–º—É –æ–Ω–∞ –¥–ª—è –º–µ–Ω—è –≤–∞–∂–Ω–∞. / I reflect why a goal matters to me.",
  "–Ø –¥–µ–ª—é –±–æ–ª—å—à–∏–µ —Ü–µ–ª–∏ –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ —à–∞–≥–∏. / I break big goals into smaller steps.",
  "–Ø –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É—é —Å–≤–æ–∏ —Ü–µ–ª–∏, –∫–æ–≥–¥–∞ –æ–±—Å—Ç–æ—è—Ç–µ–ª—å—Å—Ç–≤–∞ –º–µ–Ω—è—é—Ç—Å—è. / I adjust goals when circumstances change.",
  "–ü–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º —è –æ–±—ã—á–Ω–æ —Å–æ—Å—Ç–∞–≤–ª—è—é –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω. / I usually make a detailed plan before acting.",
  "–Ø –ø–ª–∞–Ω–∏—Ä—É—é –¥–µ–Ω—å —Ç–∞–∫, —á—Ç–æ–±—ã —Ö–≤–∞—Ç–∏–ª–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –≥–ª–∞–≤–Ω–æ–µ. / I plan my day to leave time for priorities.",
  "–Ø –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—é –≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∑–∞—Ä–∞–Ω–µ–µ, –∞ –Ω–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ. / I prefer preparation over spontaneity.",
  "–Ø —É–º–µ—é –æ—Ü–µ–Ω–∏–≤–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –Ω—É–∂–Ω–æ –¥–ª—è –∑–∞–¥–∞–Ω–∏—è. / I estimate time for tasks accurately.",
  "–Ø –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—é —Å–≤–æ–∏ –ø–ª–∞–Ω—ã –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –≤–Ω–æ—à—É –∏–∑–º–µ–Ω–µ–Ω–∏—è. / I review and change plans when needed.",
  "–Ø –º–æ–≥—É –∑–∞—Å—Ç–∞–≤–∏—Ç—å —Å–µ–±—è –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç—É, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –Ω–µ —Ö–æ—á–µ—Ç—Å—è. / I can force myself to continue even when unwilling.",
  "–Ø –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É—é —Å–≤–æ–∏ —ç–º–æ—Ü–∏–∏, –∫–æ–≥–¥–∞ —á—Ç–æ-—Ç–æ –∏–¥—ë—Ç –Ω–µ —Ç–∞–∫. / I control emotions when things go wrong.",
  "–Ø –∏–∑–±–µ–≥–∞—é –æ—Ç–≤–ª–µ–∫–∞—é—â–∏—Ö —Ñ–∞–∫—Ç–æ—Ä–æ–≤, –∫–æ–≥–¥–∞ –∑–∞–Ω–∏–º–∞—é—Å—å –≤–∞–∂–Ω—ã–º –¥–µ–ª–æ–º. / I avoid distractions during important work.",
  "–Ø —Å–æ—Ö—Ä–∞–Ω—è—é —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –≤ —Å—Ç—Ä–µ—Å—Å–æ–≤—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö. / I stay calm under stress.",
  "–Ø –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–µ–Ω –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Å–≤–æ–∏—Ö —Ä–µ—à–µ–Ω–∏–π. / I follow through on decisions."
];
const selfmg_qs = selfmg_items.map((it,i)=>({prompt: it, labels: ["1 ‚Äî –ù–∏–∫–æ–≥–¥–∞","2 ‚Äî –†–µ–¥–∫–æ","3 ‚Äî –ò–Ω–æ–≥–¥–∞","4 ‚Äî –ß–∞—Å—Ç–æ","5 ‚Äî –í—Å–µ–≥–¥–∞"], required:true, name:`selfmg_${i+1}`}));
timeline.push({type: jsPsychSurveyLikert, preamble:"<h3>Peisakhov Self-Management Questionnaire</h3>", questions: selfmg_qs});

/* -----------------------
   BART implementation ‚Äî 20 balloons
   ----------------------- */
const nBalloons = 20;
let BART_logs = [];
let totalPoints = 0;

// BART instructions
timeline.push({
  type: jsPsychHtmlButtonResponse,
  stimulus: function(){ return txt("<h3>–¢–µ–ø–µ—Ä—å –≤—ã –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫—É—é –∑–∞–¥–∞—á—É BART (20 —Ä–∞—É–Ω–¥–æ–≤)</h3>","You will now complete a short BART task (20 rounds)"); },
  choices: [txt("–ù–∞—á–∞—Ç—å / Begin","Begin")]
});

// generate balloon thresholds in call-function
timeline.push({
  type: jsPsychCallFunction,
  func: function(){
    window._balloon_thresholds = [];
    for(let i=0;i<nBalloons;i++){
      // typical BART uses a distribution; use 1..32 uniform
      window._balloon_thresholds.push(Math.floor(Math.random()*32)+1);
    }
  }
});

// Loop over balloons
for(let b=0;b<nBalloons;b++){
  // initialize balloon state
  timeline.push({
    type: jsPsychCallFunction,
    func: (function(idx){ return function(){ window._balloon_state = {index: idx, pumps:0, exploded:false, collected:false}; }; })(b)
  });

  // start screen
  timeline.push({
    type: jsPsychHtmlButtonResponse,
    stimulus: function(){ return `<div class="center"><h4>${txt("–®–∞—Ä–∏–∫","Balloon")} ${b+1} / ${nBalloons}</h4></div>`; },
    choices: [txt("Start / –ù–∞—á–∞—Ç—å","Start")]
  });

  // pump/collect loop (html-button-response repeated)
  timeline.push({
    timeline: [{
      type: jsPsychHtmlButtonResponse,
      stimulus: function(){
        const st = window._balloon_state || {pumps:0};
        const visual = "üéà".repeat(Math.max(1, Math.floor(st.pumps/4)+1));
        return `<div class="center"><div class="balloon">${visual}</div>
                <p>${txt("–ù–∞–¥—É–≤–∞–Ω–∏—è / Pumps","Pumps")}: ${st.pumps}</p>
                <p>${txt("–ù–∞–∂–º–∏—Ç–µ Pump –∏–ª–∏ Collect","Press Pump or Collect")}</p></div>`;
      },
      choices: [txt("Pump","Pump"), txt("Collect","Collect")],
      on_finish: function(data){
        // nothing here; loop handler will read latest
      }
    }],
    loop_function: function(){
      // read last
      const last = jsPsych.data.get().last(1).values()[0];
      const st = window._balloon_state;
      if(!last) return false;
      // response 0 = Pump, 1 = Collect
      if(last.response === 0){
        st.pumps += 1;
        BART_logs.push({event:'pump', balloon: b+1, pumps: st.pumps, ts: Date.now()});
        // explosion check
        if(st.pumps >= window._balloon_thresholds[b]){
          st.exploded = true;
          BART_logs.push({event:'explosion', balloon: b+1, pumps: st.pumps, ts: Date.now()});
          return false;
        } else return true;
      } else {
        st.collected = true;
        const earned = st.pumps;
        totalPoints += earned;
        BART_logs.push({event:'collect', balloon: b+1, pumps: st.pumps, earned: earned, ts: Date.now()});
        return false;
      }
    }
  });

  // feedback
  timeline.push({
    type: jsPsychHtmlButtonResponse,
    stimulus: function(){
      const st = window._balloon_state;
      if(st.exploded) return `<div class="center">${txt("–®–∞—Ä–∏–∫ –ª–æ–ø–Ω—É–ª ‚Äî 0 –æ—á–∫–æ–≤ / Balloon exploded ‚Äî 0 points","Balloon exploded ‚Äî 0 points")}</div>`;
      else return `<div class="center">${txt("–í—ã —Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ "+st.pumps+" –æ—á–∫–æ–≤","You collected "+st.pumps+" points")}</div>`;
    },
    choices: [txt("–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å / Continue","Continue")]
  });
}

// BART final summary and add to dataset
timeline.push({
  type: jsPsychHtmlButtonResponse,
  stimulus: function(){ return `<div class="center"><h3>${txt("BART –∑–∞–≤–µ—Ä—à–µ–Ω","BART complete")}</h3>
                                <p>${txt("–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç:","Your score:")} ${totalPoints}</p>
                                <p>${txt("–ö–æ–¥ —É—á–∞—Å—Ç–Ω–∏–∫–∞:","Participant code:")} <strong>BART-${totalPoints}</strong></p></div>`; },
  choices: [txt("–î–∞–ª–µ–µ / Next","Next")],
  on_finish: function(){
    jsPsych.data.addProperties({bart_total: totalPoints, bart_code: `BART-${totalPoints}`, bart_events: JSON.stringify(BART_logs)});
  }
});

/* -----------------------
   END: submit data to Google Sheets (POST) and offer CSV fallback
   ----------------------- */
timeline.push({
  type: jsPsychCallFunction,
  func: function(){
    // assemble a clean data object
    const fullData = { timestamp: (new Date()).toISOString(), language: window._study_language || 'ru' };
    // gather the latest trial-by-trial data as array of objects
    const all = jsPsych.data.get().filter({}).values();
    fullData.jspsych = all; // includes responses, trial types, etc.
    // extra summary properties if desired are already addToLast earlier
    // POST to Google Sheets
    fetch(GOOGLE_SHEETS_URL, {
      method: 'POST',
      mode: 'no-cors', // Apps Script often requires no-cors for simple exec endpoints; response not readable
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(fullData)
    }).then(function(){
      // we cannot rely on response when no-cors; still proceed
      console.log("Posted to Google Sheets (no-cors fetch invoked).");
    }).catch(function(err){
      console.warn("POST to Google Sheets failed:", err);
    }).finally(function(){
      // also trigger local CSV download for redundancy
      jsPsych.data.get().localSave('csv','mental_states_decision_data.csv');
    });
  }
});

/* Final Thank-you page */
timeline.push({
  type: jsPsychHtmlButtonResponse,
  stimulus: function(){ return `<div class="center"><h3>${txt("–°–ø–∞—Å–∏–±–æ!","Thank you!")}</h3>
                                    <p>${txt("–î–∞–Ω–Ω—ã–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã ‚Äî –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ.","Your data have been submitted ‚Äî you may close this window.")}</p></div>`; },
  choices: [txt("–ó–∞–≤–µ—Ä—à–∏—Ç—å / Finish","Finish")]
});

/* Run it */
jsPsych.run(timeline);

</script>
</body>
</html>
